<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introducing revdbayes: Ratio-of-Uniforms Sampling for Bayesian Extreme Value Analysis • revdbayes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introducing revdbayes: Ratio-of-Uniforms Sampling for Bayesian Extreme Value Analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">revdbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/revdbayes-a-vignette.html">Introducing revdbayes: Ratio-of-Uniforms Sampling for Bayesian Extreme Value Analysis</a>
    </li>
    <li>
      <a href="../articles/revdbayes-b-using-rcpp-vignette.html">Faster simulation using revdbayes</a>
    </li>
    <li>
      <a href="../articles/revdbayes-c-predictive-vignette.html">Posterior Predictive Extreme Value Inference using the revdbayes Package</a>
    </li>
    <li>
      <a href="../articles/revdbayes-d-kgaps-vignette.html">Inference for the extremal index using the K-gaps model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paulnorthrop/revdbayes">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introducing revdbayes: Ratio-of-Uniforms Sampling for Bayesian Extreme Value Analysis</h1>
                        <h4 class="author">Paul J. Northrop</h4>
            
            <h4 class="date">2019-11-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/revdbayes/blob/master/vignettes/revdbayes-a-vignette.Rmd"><code>vignettes/revdbayes-a-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>revdbayes-a-vignette.Rmd</code></div>

    </div>

    
    
<p>This vignette focuses on random sampling from extreme value posterior distributions using the function <code>rpost</code>. From version 1.2.0 onwards sampling can be achieved more quickly using the function <code>rpost_rcpp</code>. See the vignette <a href="revdbayes-b-using-rcpp-vignette.html">Faster simulation using revdbayes</a> for details.</p>
<p>Performing posterior predictive extreme value inference using posterior samples is covered in a separate vignette <a href="revdbayes-c-predictive-vignette.html">Posterior Predictive Extreme Value Inference using the revdbayes Package</a></p>
<div id="the-revdbayes-package" class="section level3">
<h3 class="hasAnchor">
<a href="#the-revdbayes-package" class="anchor"></a>The <em>revdbayes</em> package</h3>
<p>The <em>revdbayes</em> package tackles the same problem as the <em>evdbayes</em> package <span class="citation">(Stephenson and Ribatet 2014)</span>, that is, sampling from posterior distributions that occur in some relatively simple Bayesian extreme value analyses. The essential difference between these two packages is that evdbayes performs sampling using Markov Chain Monte Carlo (MCMC) techniques, whereas revdbayes uses the generalised ratio-of-uniforms method <span class="citation">(Wakefield, Gelfand, and Smith 1991)</span>, implemented using the <em>rust</em> package <span class="citation">(Northrop 2017)</span>. Otherwise, these two packages have similar functionality and their functions have a similar syntax. For example, a prior distribution specified using one package may be used in posterior sampling implemented by the other. For details of setting prior distributions see the <code>set_prior</code> function.</p>
<p>For details of Bayesian extreme value analyses see the review of <span class="citation">Stephenson (2016)</span> and the evdbayes user guide (available in the evdbayes doc directory). Typically, MCMC is used to sample from extreme value posterior distributions. This requires tuning parameters of the MCMC algorithm to be set and results in a dependent sample from the posterior. Diagnostics checks, based on running multiple chains from different starting values, are used to check convergence and to decide which values should be discarded prior to approximate convergence. An advantage of using a direct method of simulation, such as the generalised ratio-of-uniforms method, is that it produces a random example from the posterior distribution. This method also involves tuning parameters, but the revdbayes package has been designed to set those automatically.</p>
<p>The current version of revdbayes samples from posterior distributions based on the Generalised Extreme Value (GEV) model, the Generalised Pareto (GP) model, the point process (PP) model and the <em>r</em>-largest order statistics (OS) model. The evdbayes package offers in addition some extreme value regression models.</p>
<p>We consider how to use the two main functions in revdbayes, namely <code>set_prior</code> (used to define the prior distribution) and <code>rpost</code> (used to sample from the posterior distribution). We use the examples in the evdbayes user guide for illustration and as a check that the two packages, evdbayes and revdbayes produce comparable results. Please see the evdbayes user guide for details of the models underlying these analyses.</p>
</div>
<div id="the-ratio-of-uniforms-method" class="section level3">
<h3 class="hasAnchor">
<a href="#the-ratio-of-uniforms-method" class="anchor"></a>The ratio-of-uniforms method</h3>
<p>The ratio-of-uniforms method is an acceptance-rejection type of simulation algorithm. A crude measure of the efficiency of the algorithm is the probability <span class="math inline">\(p_a\)</span> that a proposed value is accepted. In the rust package <span class="citation">(Northrop 2017)</span> variable transformation is used to increase <span class="math inline">\(p_a\)</span>. In the current context two transformations are of interest: (i) marginal Box-Cox transformation of (positive functions of) extreme value parameters (using argument <code>trans = "BC"</code> to <code>rpost</code> instead of the default <code>trans = "none"</code>), and/or (ii) rotation of parameter axes about the estimated mode of the posterior (the default <code>rotate = TRUE</code> instead of the <code>rotate = FALSE</code>), based on the estimated Hessian of the log-posterior at this mode. Transformation (i) seeks to reduce skewness in the marginal posterior distributions. Transformation (ii) tends to reduce posterior dependence between the parameters. The ratio-of-uniforms algorithm is then performed after relocating the mode of the posterior to the origin, because this tends to increase the probability of acceptance <span class="citation">(Wakefield, Gelfand, and Smith 1991)</span>.</p>
<p>For details of the ratio-of-uniforms method and the transformations used see the vignette of the rust package <span class="citation">(Northrop 2017)</span>. In the **rust* vignette it is argued that the largest attainable value of <span class="math inline">\(p_a\)</span> for a typical <span class="math inline">\(d\)</span>-dimensional problem is the value resulting from the special case of a <span class="math inline">\(d\)</span>-dimensional normal distribution with independent components. For <span class="math inline">\(d=2\)</span> this value is 0.534, for <span class="math inline">\(d=3\)</span> the value is 0.316. In an object <code>ru_object</code> returned from <code>rpost</code> an estimate of this probability is given by <code>ru_object$pa</code>. The examples presented in this vignette suggest that often rotation to reduce dependence is more helpful than marginal transformation to reduce skewness. This (<code>trans = "none"</code> and <code>rotate = TRUE</code>) is the default setting of <code>rpost</code> and seems to work well enough for most problems.</p>
<p>The computations in the following sections were performed using a notebook containing a 3.0GHz Intel processor and 8GB RAM.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(revdbayes)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(evdbayes)
<span class="co"># Set the number of posterior samples required.</span>
n &lt;-<span class="st"> </span><span class="dv">10000</span>
<span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">46</span>)</code></pre></div>
</div>
<div id="generalised-pareto-gp-model" class="section level2">
<h2 class="hasAnchor">
<a href="#generalised-pareto-gp-model" class="anchor"></a>Generalised Pareto (GP) model</h2>
<p>The GP distribution is used to model <em>threshold excesses</em>, that is, the amounts by which <em>threshold exceedances</em> exceed some threshold. It has two parameters: a scale parameter <span class="math inline">\(\sigma_u\)</span> and shape parameter <span class="math inline">\(\xi\)</span>. We use the following example to illustrate the use of the transformation strategies implemented by the arguments <code>rotate</code> and <code>trans</code> to <code>rpost</code> and how the user can specify their own prior distribution.</p>
<div id="gulf-of-mexico-wave-height-data" class="section level3">
<h3 class="hasAnchor">
<a href="#gulf-of-mexico-wave-height-data" class="anchor"></a>Gulf of Mexico Wave Height Data</h3>
<p>The numeric vector <code>gom</code> contains 315 storm peak significant wave heights from a location in the Gulf of Mexico, from the years 1900 to 2005. These data are analysed in <span class="citation">Northrop, Attalides, and Jonathan (2017)</span>. We set the threshold at the 65% sample quantile and use <code>set_prior</code> to set a prior.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(gom)
thresh &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(gom, <span class="dt">probs =</span> <span class="fl">0.65</span>)
fp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_prior.html">set_prior</a></span>(<span class="dt">prior =</span> <span class="st">"flat"</span>, <span class="dt">model =</span> <span class="st">"gp"</span>, <span class="dt">min_xi =</span> <span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<p>We sample first on the <span class="math inline">\((\sigma_u, \xi)\)</span> scale, with mode relocation only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
gp1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gp"</span>, <span class="dt">prior =</span> fp, <span class="dt">thresh =</span> thresh, <span class="dt">data =</span> gom,
             <span class="dt">rotate =</span> <span class="ot">FALSE</span>)
)[<span class="dv">3</span>]</code></pre></div>
<p>Then we add a rotation of <span class="math inline">\((\sigma_u, \xi)\)</span> about the estimated posterior mode.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
gp2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gp"</span>, <span class="dt">prior =</span> fp, <span class="dt">thresh =</span> thresh, <span class="dt">data =</span> gom)
)[<span class="dv">3</span>]</code></pre></div>
<p>Now we add marginal Box-Cox transformation. We apply Box-Cox transformation to the parameters <span class="math inline">\(\phi_1 = \sigma_u\)</span> and <span class="math inline">\(\phi_2 = \xi + \sigma / x_{(m)}\)</span>, where <span class="math inline">\(x_{(m)}\)</span> is the largest threshold excess. The parameters <span class="math inline">\(\phi_1\)</span> and <span class="math inline">\(\phi_2\)</span> are positive for all combinations of <span class="math inline">\((\sigma_u, \xi)\)</span> for which the GP likelihood is positive.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t3 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
gp3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gp"</span>, <span class="dt">prior =</span> fp, <span class="dt">thresh =</span> thresh, <span class="dt">data =</span> gom,
             <span class="dt">rotate =</span> <span class="ot">FALSE</span>, <span class="dt">trans =</span> <span class="st">"BC"</span>)
)[<span class="dv">3</span>]
t4 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
gp4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gp"</span>, <span class="dt">prior =</span> fp, <span class="dt">thresh =</span> thresh, <span class="dt">data =</span> gom,
             <span class="dt">trans =</span> <span class="st">"BC"</span>)
)[<span class="dv">3</span>]</code></pre></div>
<p>We plot the samples obtained with the contours of the corresponding densities superimposed. The plot on the top left is on the original <span class="math inline">\((\sigma_u, \xi)\)</span> scale. The other plots are on the scale used for the ratio-of-uniforms algorithm, that is, with relocation of the mode to the origin. In the following the <span class="math inline">\(\rho_i, i = 1, \ldots, d\)</span>, <span class="math inline">\(\rho_1\)</span> and <span class="math inline">\(\rho_2\)</span> in this example, are the variables to which the ratio-of-uniforms algorithm is applied, i.e. after any transformation (Box-Cox and/or rotation of axes) and relocation of the mode to the origin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(gp1, <span class="dt">ru_scale =</span> <span class="ot">FALSE</span>, <span class="dt">cex.main =</span> <span class="fl">0.75</span>, <span class="dt">cex.lab =</span> <span class="fl">0.75</span>, 
  <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"no transformation </span><span class="ch">\n</span><span class="st"> pa = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(gp1<span class="op">$</span>pa, <span class="dv">3</span>), 
               <span class="st">", time = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(t1, <span class="dv">2</span>), <span class="st">"s"</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(gp2, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>, <span class="dt">cex.main =</span> <span class="fl">0.75</span>, <span class="dt">cex.lab =</span> <span class="fl">0.75</span>, 
  <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"rotation </span><span class="ch">\n</span><span class="st"> pa = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(gp2<span class="op">$</span>pa, <span class="dv">3</span>),
               <span class="st">", time = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(t2, <span class="dv">2</span>), <span class="st">"s"</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(gp3, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>, <span class="dt">cex.main =</span> <span class="fl">0.75</span>, <span class="dt">cex.lab =</span> <span class="fl">0.75</span>, 
  <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Box-Cox </span><span class="ch">\n</span><span class="st"> pa = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(gp3<span class="op">$</span>pa, <span class="dv">3</span>),
               <span class="st">", time = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(t3, <span class="dv">2</span>), <span class="st">"s"</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(gp4, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>, <span class="dt">cex.main =</span> <span class="fl">0.75</span>, <span class="dt">cex.lab =</span> <span class="fl">0.75</span>,
  <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Box-Cox and rotation </span><span class="ch">\n</span><span class="st"> pa = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(gp4<span class="op">$</span>pa, <span class="dv">3</span>),
               <span class="st">", time = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(t4, <span class="dv">2</span>), <span class="st">"s"</span>))</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-7-1.png" width="700"><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-7-2.png" width="700"><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-7-3.png" width="700"><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-7-4.png" width="700"></p>
<p>Comparison of the plots on the right to the plots on the left shows that rotation of the parameter axes about the mode of the posterior has reduced dependence between the components. The estimated probabilities of acceptance for the plots on the right are close to the 0.534 obtained for a 2-dimensional normal distribution with independent components. Box-Cox transformation has increased the estimated value of <span class="math inline">\(p_a\)</span> but not by much. In fact, the extra computation time required to calculate the Box-Cox transformation each time that the posterior density is evaluated means that posterior sampling is slower than the default setting of <code>rotate = TRUE</code> and <code>trans = "none"</code>. That is, in this example at least, the increase is <span class="math inline">\(p_a\)</span> resulting from the addition of the Box-Cox transformation is not sufficient to offset the extra time needed to compute the posterior density.</p>
<pre><code>#&gt; Warning in (function (logf, ..., n = 1, d = 1, init = NULL, trans =
#&gt; c("none", : One or more convergence indicators are non-zero.
#&gt;                box      vals1        vals2 conv
#&gt; a        1.0000000  0.0000000  0.000000000    0
#&gt; b1minus -0.4702123 -0.6881406 -0.009798245    0
#&gt; b2minus -0.5005432  1.4939262 -0.826484913    0
#&gt; b1plus   1.1543425  3.1506455 -1.257680739   52
#&gt; b2plus   1.0506748  2.6525730  2.409230370    0</code></pre>
<p>Repeating the rotation only and Box-Cox transformation plus rotation analyses for a much higher threshold, set at the 95% sample quantile, produces the following plots. Strong asymmetry in the posterior distribution means that the combination of marginal Box-Cox transformation and rotation produces a larger improvement in <span class="math inline">\(p_a\)</span> and means that now this strategy is competitive with using rotation alone in terms of computation time. Box-Cox transformation also produces a distribution for which the optimisations involved in the ratio-of-uniforms method will have greater stability.</p>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<p><strong>A User-defined prior</strong></p>
<p>Suppose that we wish to use a prior for <span class="math inline">\((\sigma_u, \xi)\)</span> with a density that is proportional to <span class="math inline">\(\sigma_u^{-1} (1+\xi)^{\alpha-1} (1-\xi)^{\beta-1}\)</span>, for <span class="math inline">\(\sigma_u &gt; 0, -1 &lt; \xi &lt; 1\)</span> and for some <span class="math inline">\(\alpha &gt; 0\)</span> and <span class="math inline">\(\beta &gt; 0\)</span>. This is an improper prior in which <span class="math inline">\(\sigma_u\)</span> and <span class="math inline">\(\xi\)</span> are independent <em>a priori</em>, <span class="math inline">\(\log \sigma_u\)</span> is uniform over the real line and <span class="math inline">\(\xi\)</span> has beta(<span class="math inline">\(\alpha, \beta\)</span>)-type distribution on the interval <span class="math inline">\((-1, 1)\)</span>. We can do this by creating a function that returns the prior log-density and passing this function to <code>set_prior</code>. The first argument of the prior log-density function must be the parameter vector (the GP parameters <span class="math inline">\((\sigma_u, \xi)\)</span> in this case), followed by any hyperparameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">u_prior_fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, ab) {
  <span class="co">#</span>
  <span class="co"># Calculates the the log of the (improper) prior density for GP parameters </span>
  <span class="co"># (sigma_u, xi) in which log(sigma_u) is uniform on the real line and xi has </span>
  <span class="co"># a beta(alpha, beta)-type prior on the interval (-1, 1).</span>
  <span class="co">#</span>
  <span class="co"># Args:</span>
  <span class="co">#   x  : A numeric vector.  GP parameter vector (sigma, xi).</span>
  <span class="co">#   ab : A numeric vector.  Hyperparameter vector (alpha, beta), where</span>
  <span class="co">#        alpha and beta must be positive.</span>
  <span class="co">#</span>
  <span class="co"># Returns : the value of the log-prior at x.</span>
  <span class="co">#</span>
  <span class="cf">if</span> (x[<span class="dv">1</span>] <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>x[<span class="dv">2</span>] <span class="op">&lt;=</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>x[<span class="dv">2</span>] <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) {
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="op">-</span><span class="ot">Inf</span>)
  }  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(x[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span>(ab[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">           </span>(ab[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x[<span class="dv">2</span>]))
}
up &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_prior.html">set_prior</a></span>(<span class="dt">prior =</span> u_prior_fn, <span class="dt">ab =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">model =</span> <span class="st">"gp"</span>)
gp_u &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gp"</span>, <span class="dt">prior =</span> up, <span class="dt">thresh =</span> thresh, <span class="dt">data =</span> gom)</code></pre></div>
</div>
</div>
<div id="the-generalised-extreme-value-gev-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-generalised-extreme-value-gev-model" class="anchor"></a>The Generalised Extreme Value (GEV) model</h2>
<p>We consider two examples involving the GEV distribution, which is used to model block maxima. The GEV distribution has three parameters: a location parameter <span class="math inline">\(\mu\)</span>, a scale parameter <span class="math inline">\(\sigma\)</span> and a shape parameter <span class="math inline">\(\xi\)</span>. In the first example we illustrate the use of <code>set_prior</code> to set a prior distribution for the GEV parameters and show that a prior set using <code>set_prior</code> (including user-defined prior) can be used as an argument to the evdbayes function <code>posterior</code>. In the second example we show that the reverse is also true, that is, a prior set using an evdbayes function (<code>prior.prob</code>) can be used an an argument to the revdbayes function <code>rpost</code>.</p>
<div id="port-pirie-sea-level-data" class="section level3">
<h3 class="hasAnchor">
<a href="#port-pirie-sea-level-data" class="anchor"></a>Port Pirie Sea Level Data</h3>
<p>The numeric vector <code>portpirie</code> contains 65 annual maximum sea levels (in metres) recorded at Port Pirie, South Australia, from 1923 to 1987.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(portpirie)
mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10000</span>, <span class="dv">10000</span>, <span class="dv">100</span>))
pn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_prior.html">set_prior</a></span>(<span class="dt">prior =</span> <span class="st">"norm"</span>, <span class="dt">model =</span> <span class="st">"gev"</span>, <span class="dt">mean =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">cov =</span> mat)
p1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gev"</span>, <span class="dt">prior =</span> pn, <span class="dt">data =</span> portpirie)
p1<span class="op">$</span>pa
<span class="co">#&gt; [1] 0.2981159</span></code></pre></div>
<p>The proportion of accepted values is close to the best we can hope for in this 3-dimensional example, i.e. 0.316. The following plots illustrate the effect of <code>rotate = TRUE</code>. The plot on the left shows the simulated values of the GEV parameters. There is some association between the parameters <em>a posteriori</em>, albeit weak association. The plot on the right shows the values simulated on the scale used in the ratio-of-uniforms algorithm. The association has been reduced by rotating the parameter axes. The increase in the proportion of accepted values is only modest in this example (from approximately 0.26 to 0.30) but this improvement is more substantial in other examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(p1, <span class="dt">cex.main =</span> <span class="fl">0.75</span>, <span class="dt">cex.lab =</span> <span class="fl">0.75</span>, 
  <span class="dt">main =</span> <span class="st">"original scale"</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(p1, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>, <span class="dt">cex.main =</span> <span class="fl">0.75</span>, <span class="dt">cex.lab =</span> <span class="fl">0.75</span>,
     <span class="dt">main =</span> <span class="st">"sampling scale"</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-12-2.png" width="672"></p>
<p>After tuning the MCMC algorithm the evdbayes user guide suggests the following initial values (t0) and proposal standard deviations, and a burn-in period of 200 simulated values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># evdbayes</span>
t0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3.87</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.05</span>) 
s &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">06</span>, .<span class="dv">25</span>, .<span class="dv">25</span>)
b &lt;-<span class="st"> </span><span class="dv">200</span>
p2 &lt;-<span class="st"> </span><span class="kw">posterior</span>(n <span class="op">+</span><span class="st"> </span>b <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, t0, <span class="dt">prior =</span> pn, <span class="dt">lh =</span> <span class="st">"gev"</span>, <span class="dt">data =</span> portpirie, 
                <span class="dt">psd =</span> s, <span class="dt">burn =</span> b)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(p2[, <span class="dv">1</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(mu))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(p1<span class="op">$</span>sim_vals[, <span class="dv">1</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(p2[, <span class="dv">2</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(sigma))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(p1<span class="op">$</span>sim_vals[, <span class="dv">2</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"evdbayes"</span>, <span class="st">"revdbayes"</span>), <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">cex =</span> <span class="fl">0.8</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(p2[, <span class="dv">3</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(xi))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(p1<span class="op">$</span>sim_vals[, <span class="dv">3</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>Now we show that a user-defined prior created using <code>set_prior</code> can be used with the evdbayes function <code>posterior</code>. We use a similar user-defined prior to the GP example above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">u_gev_prior_fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, ab) {
  <span class="co">#</span>
  <span class="co"># Calculates the the log of the (improper) prior density for GEV parameters </span>
  <span class="co"># (mu, sigma, xi) in which mu and log(sigma) are each uniform on the real </span>
  <span class="co"># line and xi has a beta(alpha, beta)-type prior on the interval (-1, 1).</span>
  <span class="co">#</span>
  <span class="co"># Args:</span>
  <span class="co">#   x  : A numeric vector.  GP parameter vector (mu, sigma, xi).</span>
  <span class="co">#   ab : A numeric vector.  Hyperparameter vector (alpha, beta), where</span>
  <span class="co">#        alpha and beta must be positive.</span>
  <span class="co">#</span>
  <span class="co"># Returns : the value of the log-prior at x.</span>
  <span class="co">#</span>
  <span class="cf">if</span> (x[<span class="dv">2</span>] <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>x[<span class="dv">3</span>] <span class="op">&lt;=</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>x[<span class="dv">3</span>] <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) {
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="op">-</span><span class="ot">Inf</span>)
  }  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(x[<span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span>(ab[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x[<span class="dv">3</span>]) <span class="op">+</span>
<span class="st">           </span>(ab[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x[<span class="dv">3</span>]))
}
up &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_prior.html">set_prior</a></span>(<span class="dt">prior =</span> u_gev_prior_fn, <span class="dt">ab =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">model =</span> <span class="st">"gev"</span>)
<span class="co"># Using revdbayes function rpost()</span>
p1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"gev"</span>, <span class="dt">prior =</span> up, <span class="dt">thresh =</span> thresh, <span class="dt">data =</span> gom)
<span class="co"># Using evdbayes function posterior()</span>
t0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3.87</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.05</span>) 
s &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">06</span>, .<span class="dv">25</span>, .<span class="dv">25</span>)
p2 &lt;-<span class="st"> </span><span class="kw">posterior</span>(n <span class="op">+</span><span class="st"> </span><span class="dv">200</span>, t0, <span class="dt">prior =</span> up, <span class="dt">lh =</span> <span class="st">"gev"</span>, <span class="dt">data =</span> portpirie, <span class="dt">psd =</span> s)</code></pre></div>
</div>
<div id="oxford-temperature-data" class="section level3">
<h3 class="hasAnchor">
<a href="#oxford-temperature-data" class="anchor"></a>Oxford Temperature Data</h3>
<p>The numeric vector <code>oxford</code> contains 80 annual maximum temperatures, in degrees Fahrenheit, from 1901 to 1980 at Oxford, England.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(oxford)
prox &lt;-<span class="st"> </span><span class="kw">prior.prob</span>(<span class="dt">quant =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">85</span>,<span class="dv">88</span>,<span class="dv">95</span>), <span class="dt">alpha =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">2.25</span>,<span class="fl">0.25</span>))
<span class="co"># evdbayes</span>
t0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">84</span>,<span class="fl">4.2</span>,<span class="op">-</span><span class="fl">0.3</span>) 
s &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.25</span>,.<span class="dv">2</span>,.<span class="dv">1</span>) 
b &lt;-<span class="st"> </span><span class="dv">1000</span>
ox.post &lt;-<span class="st"> </span><span class="kw">posterior</span>(n <span class="op">+</span><span class="st"> </span>b <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, t0, prox, <span class="dt">lh =</span> <span class="st">"gev"</span>, <span class="dt">data =</span> oxford, <span class="dt">psd =</span> s, 
                     <span class="dt">burn =</span> b)
<span class="co"># revdbayes</span>
ox_post &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">model =</span> <span class="st">"gev"</span>, <span class="dt">prior =</span> prox, <span class="dt">data =</span> oxford)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(ox.post[, <span class="dv">1</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(mu))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(ox_post<span class="op">$</span>sim_vals[, <span class="dv">1</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(ox.post[, <span class="dv">2</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(sigma))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(ox_post<span class="op">$</span>sim_vals[, <span class="dv">2</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"evdbayes"</span>, <span class="st">"revdbayes"</span>), <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">cex =</span> <span class="fl">0.8</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(ox.post[, <span class="dv">3</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(xi))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(ox_post<span class="op">$</span>sim_vals[, <span class="dv">3</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>We do not illustrate the use of marginal Box-Cox transformation in the GEV case. If <code>trans = "BC"</code> then we use <span class="math inline">\(\phi_1 = \mu\)</span>, <span class="math inline">\(\phi_2 = [\sigma + \xi (x_{(1)} - \mu) ] / (x_{(m)} - x_{(1)})^{1/2}\)</span> and <span class="math inline">\(\phi_3 = [\sigma + \xi (x_{(m)} - \mu) ] / (x_{(m)} - x_{(1)})^{1/2}\)</span>, where <span class="math inline">\(x_{(1)}\)</span> and <span class="math inline">\(x_{(m)}\)</span> are the smallest and largest sample block maxima respectively. This transformation has been standardised to have Jacobian 1. We apply Box-Cox transformation only to the (positive) parameters <span class="math inline">\(\phi_2\)</span> and <span class="math inline">\(\phi_3\)</span>, because <span class="math inline">\(\phi_1 = \mu\)</span> is not constrained to be positive and tends to have a marginal posterior distribution that is not strongly skewed.</p>
</div>
</div>
<div id="point-process-pp-model" class="section level2">
<h2 class="hasAnchor">
<a href="#point-process-pp-model" class="anchor"></a>Point Process (PP) model</h2>
<p>Like the GP model the PP model involves exceedances of a threshold <code>thresh</code>. However, the PP model has one more parameter than the GP model, three parameters <span class="math inline">\((\mu, \sigma, \xi)\)</span> say, because it considers the number of threshold exceedances (that is, in addition to the sizes of the threshold excesses. The interpretation of the parameters <span class="math inline">\((\mu, \sigma, \xi)\)</span> is determined by the number of periods of observation, or blocks, into which the data are grouped. This is set using the argument <code>noy</code> to <code>rpost</code>. Under the PP model the distribution of the maximum over each of these blocks has approximately a GEV distribution with parameters <span class="math inline">\((\mu, \sigma, \xi)\)</span>, provided that the numbers of observations within each block are large. Although the user may require a posterior sample based on a particular value of <code>noy</code> it may be that the sampling itself is more efficient when a different value of <code>noy</code> is used.</p>
<p>We illustrate the use of a prior created by the evdbayes package as an argument to the revdbayes function <code>rpost</code>. We also show how the choice of parameterisation of the model affects the strength posterior dependence between those parameters and hence the efficiency of simulation from the posterior. <span class="citation">Wadsworth, Tawn, and Jonathan (2010)</span> note that posterior dependence between the location parameter and the other two parameters tends to be reduced if we use a parameterisation in which the number of blocks is equal to the number of threshold excesses, rather the typical parameterisation where the number of blocks is equal to the number of years of data. This is because, in the context of the likelihood alone, <span class="math inline">\(\mu\)</span> is orthogonal to (<span class="math inline">\(\sigma, \xi\)</span>) under this parameterisation. Suppose that <span class="math inline">\((\mu, \sigma, \xi)\)</span> is the parameter vector on the scale of interest, that is, when the number of blocks is equal to <code>noy</code> and <span class="math inline">\((\mu_e, \sigma_e, \xi)\)</span> is the parameter vector when the number of blocks is set equal to the number of threshold excesses <span class="math inline">\(n_{exc}\)</span>. Then <span class="math inline">\(\mu_e = \mu + \sigma (c ^ \xi - 1) / \xi\)</span>, and <span class="math inline">\(\sigma_e = \sigma c ^ \xi\)</span> where <span class="math inline">\(c=\)</span><code>noy</code><span class="math inline">\(/n_{exc}\)</span>.</p>
<p>The <code>rotate = TRUE</code> argument of <code>rpost</code> produces a similar effect, but it can reduce posterior dependence between all parameters. Also, rotating the posterior accounts for the influence of the prior in the posterior, whereas the argument for setting <code>noy</code> equal to the number of threshold excesses is based on the likelihood alone.</p>
<div id="rainfall-data" class="section level3">
<h3 class="hasAnchor">
<a href="#rainfall-data" class="anchor"></a>Rainfall Data</h3>
<p>We illustrate the use of <code>rpost</code> to sample from a posterior distribution under the PP using the <code>rainfall</code> dataset, which contains 20820 daily rainfall totals, in mm, recorded at a rain gauge in England over a 57 year period. Three of these years contain only missing values so if we wish to parameterise the model in terms of the GEV parameters of annual maxima we should set <code>noy = 54</code> when calling <code>rpost</code>. We use the prior from the evdbayes user’s guide and a threshold of 40mm.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(rainfall)
rthresh &lt;-<span class="st"> </span><span class="dv">40</span>
prrain &lt;-<span class="st"> </span><span class="kw">prior.quant</span>(<span class="dt">shape =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">38.9</span>,<span class="fl">7.1</span>,<span class="dv">47</span>), <span class="dt">scale =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.5</span>,<span class="fl">6.3</span>,<span class="fl">2.6</span>))</code></pre></div>
<p>The plot on the left below relates to the standard parameterisation. There is posterior dependence between all parameters. The plot on the right shows that rotating the posterior using <code>rotate = TRUE</code> reduce the dependence.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Annual maximum parameterisation (number of blocks = number of years of data)</span>
rn0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"pp"</span>, <span class="dt">prior =</span> prrain, <span class="dt">data =</span> rainfall, 
  <span class="dt">thresh =</span> rthresh, <span class="dt">noy =</span> <span class="dv">54</span>, <span class="dt">rotate =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rn0)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rn0<span class="op">$</span>pa
<span class="co">#&gt; [1] 0.1664475</span>
<span class="co"># Rotation about maximum a posteriori estimate (MAP)</span>
<span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
rn1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"pp"</span>, <span class="dt">prior =</span> prrain, <span class="dt">data =</span> rainfall, 
  <span class="dt">thresh =</span> rthresh, <span class="dt">noy =</span> <span class="dv">54</span>)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    1.68    0.00    1.67</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rn1, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-19-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rn1<span class="op">$</span>pa
<span class="co">#&gt; [1] 0.3074369</span></code></pre></div>
<p>Using the <span class="citation">Wadsworth, Tawn, and Jonathan (2010)</span> parameterisation reduces the posterior dependence between <span class="math inline">\(\mu\)</span> and the other two parameters, but not between <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\xi\)</span> (plot on the left). Using the <span class="citation">Wadsworth, Tawn, and Jonathan (2010)</span> parameterisation and <code>rotate = TRUE</code> also reduces posterior dependence between all parameters but the earlier plot suggests that using <code>rotate = TRUE</code> alone is sufficient in this example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Number of blocks = number of threshold excesses</span>
n_exc &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(rainfall <span class="op">&gt;</span><span class="st"> </span>rthresh, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
rn2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"pp"</span>, <span class="dt">prior =</span> prrain, <span class="dt">data =</span> rainfall, 
  <span class="dt">thresh =</span> rthresh, <span class="dt">noy =</span> <span class="dv">54</span>, <span class="dt">use_noy =</span> <span class="ot">FALSE</span>, <span class="dt">rotate =</span> <span class="ot">FALSE</span>)
rn2<span class="op">$</span>pa
<span class="co">#&gt; [1] 0.195023</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rn2, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Number of blocks = number of threshold excesses, rotation about MAP</span>
<span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
rn3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"pp"</span>, <span class="dt">prior =</span> prrain, <span class="dt">data =</span> rainfall,
  <span class="dt">thresh =</span> rthresh, <span class="dt">noy =</span> <span class="dv">54</span>, <span class="dt">use_noy =</span> <span class="ot">FALSE</span>)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    2.11    0.00    2.11</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rn3, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-20-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rn3<span class="op">$</span>pa
<span class="co">#&gt; [1] 0.2965071</span></code></pre></div>
<p>In this example rotation of the posterior about its mode using <code>rotate = TRUE</code> produces the greatest increases in <span class="math inline">\(p_a\)</span> and, if this is performed, there is little to choose between the two choices of the number of blocks. Setting the number of blocks equal to the number of threshold excesses does reduce posterior dependence between <span class="math inline">\(\mu\)</span> and the other parameters but enough dependence between <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\xi\)</span> remains that the value of <span class="math inline">\(p_a\)</span> doesn’t increase substantially. The reparameterisation resulting from the rotation is linear in the parameters <span class="math inline">\((\mu, \sigma, \xi)\)</span>, which is simpler than the non-linear transformation from one value of the number of blocks to another. Using this non-linear transformation in addition to the rotation has increased the computation time in this example, that is, <code>rn1</code> takes a little longer to produce than <code>rn3</code> and this is also the case for other choices of prior.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># evdbayes</span>
t0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">43.2</span>, <span class="fl">7.64</span>, <span class="fl">0.32</span>) 
s &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, .<span class="dv">2</span>, .<span class="dv">07</span>)
b &lt;-<span class="st"> </span><span class="dv">2000</span>
rn.post &lt;-<span class="st"> </span><span class="kw">posterior</span>(n <span class="op">+</span><span class="st"> </span>b <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, t0, prrain, <span class="st">"pp"</span>, <span class="dt">data =</span> rainfall, 
                     <span class="dt">thresh =</span> <span class="dv">40</span>, <span class="dt">noy =</span> <span class="dv">54</span>, <span class="dt">psd =</span> s, <span class="dt">burn =</span> b)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(rn.post[, <span class="dv">1</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(mu))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(rn1<span class="op">$</span>sim_vals[, <span class="dv">1</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(rn.post[, <span class="dv">2</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(sigma))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(rn1<span class="op">$</span>sim_vals[, <span class="dv">2</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"evdbayes"</span>, <span class="st">"revdbayes"</span>), <span class="dt">lty =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">cex =</span> <span class="fl">0.8</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(rn.post[, <span class="dv">3</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(xi))
<span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(rn1<span class="op">$</span>sim_vals[, <span class="dv">3</span>], <span class="dt">adj =</span> <span class="dv">2</span>), <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>We do not illustrate the use of marginal Box-Cox transformation in the PP case. If <code>trans = "BC"</code> then we use <span class="math inline">\(\phi_1 = \mu\)</span>, <span class="math inline">\(\phi_2 = [\sigma + \xi (u - \mu) ] / (x_{(m)} - u)^{1/2}\)</span> and <span class="math inline">\(\phi_3 = [\sigma + \xi (x_{(m)} - \mu) ] / (x_{(m)} - u)^{1/2}\)</span>, where <span class="math inline">\(u\)</span> is the threshold <code>thresh</code> and <span class="math inline">\(x_{(m)}\)</span> is the largest sample value. As in the GEV case we apply Box-Cox transformation only to the (positive) parameters <span class="math inline">\(\phi_2\)</span> and <span class="math inline">\(\phi_3\)</span>.</p>
</div>
</div>
<div id="r-largest-order-statistics-os-model" class="section level2">
<h2 class="hasAnchor">
<a href="#r-largest-order-statistics-os-model" class="anchor"></a><span class="math inline">\(r\)</span>-largest Order Statistics (OS) model</h2>
<p>The OS model is an extension of the GEV model in which the <span class="math inline">\(r\)</span> largest sample values (the <span class="math inline">\(r\)</span> largest order statistics) in each block are modelled, rather than just the block maximum. More generally, if there are <span class="math inline">\(m\)</span> blocks then we can use the <span class="math inline">\(r_i\)</span> largest order statistics in block <span class="math inline">\(i\)</span>. For the purposes of illustrating how <code>rpost</code> can be used to sample from a posterior distribution under the OS model we use <code>venice</code> dataset, which (apart from one year) contains the 10 largest sea levels in Venice for the years 1931-1981. Our analysis is flawed because, as demonstrated in the evdbayes user guide, it is clear that a time trend in the location parameter <span class="math inline">\(\mu\)</span> should be considered.</p>
<div id="venice-sea-level-data" class="section level3">
<h3 class="hasAnchor">
<a href="#venice-sea-level-data" class="anchor"></a>Venice Sea Level Data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(venice)
mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10000</span>, <span class="dv">10000</span>, <span class="dv">100</span>))
pv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_prior.html">set_prior</a></span>(<span class="dt">prior =</span> <span class="st">"norm"</span>, <span class="dt">model =</span> <span class="st">"gev"</span>, <span class="dt">mean =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">cov =</span> mat)
osv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rpost.html">rpost</a></span>(<span class="dt">n =</span> n, <span class="dt">model =</span> <span class="st">"os"</span>, <span class="dt">prior =</span> pv, <span class="dt">data =</span> venice)
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(osv)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(osv, <span class="dt">ru_scale =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="revdbayes-a-vignette_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<p>We do not illustrate the use of marginal Box-Cox transformation in the OS case. If <code>trans = "BC"</code> then we use <span class="math inline">\(\phi_1 = \mu\)</span>, <span class="math inline">\(\phi_2 = [\sigma + \xi (x_{(1)} - \mu) ] / (x_{(m)} - x_{(1)})^{1/2}\)</span> and <span class="math inline">\(\phi_3 = [\sigma + \xi (x_{(m)} - \mu) ] / (x_{(m)} - x_{(1)})^{1/2}\)</span>, where <span class="math inline">\(x_{(1)}\)</span> and <span class="math inline">\(x_{(m)}\)</span> are the smallest and largest sample order statistics respectively. Again we apply Box-Cox transformation only to the (positive) parameters <span class="math inline">\(\phi_2\)</span> and <span class="math inline">\(\phi_3\)</span>.</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references">
<div id="ref-rust">
<p>Northrop, P. J. 2017. <em>rust: Ratio-of-Uniforms Simulation with Transformation</em>. <a href="https://CRAN.R-project.org/package=rust" class="uri">https://CRAN.R-project.org/package=rust</a>.</p>
</div>
<div id="ref-NAJ2016">
<p>Northrop, P. J., N. Attalides, and P. Jonathan. 2017. “Cross-Validatory Extreme Value Threshold Selection and Uncertainty with Application to Ocean Storm Severity.” <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 66 (1): 93–120. doi:<a href="https://doi.org/10.1111/rssc.12159">10.1111/rssc.12159</a>.</p>
</div>
<div id="ref-Stephenson2016">
<p>Stephenson, A. 2016. “Bayesian Inference for Extreme Value Modelling.” In <em>Extreme Value Modeling and Risk Analysis: Methods and Applications</em>, edited by D. K. Dey and J. Yan, 257–80. London: Chapman; Hall. doi:<a href="https://doi.org/10.1201/b19721">10.1201/b19721</a>.</p>
</div>
<div id="ref-evdbayes">
<p>Stephenson, A., and M. Ribatet. 2014. <em>evdbayes: Bayesian Analysis in Extreme Value Theory</em>. <a href="https://CRAN.R-project.org/package=evdbayes" class="uri">https://CRAN.R-project.org/package=evdbayes</a>.</p>
</div>
<div id="ref-WTJ2010">
<p>Wadsworth, J. L., J. A. Tawn, and P. Jonathan. 2010. “Accounting for Choice of Measurement Scale in Extreme Value Modeling.” <em>The Annals of Applied Statistics</em> 4 (3): 1558–78. doi:<a href="https://doi.org/10.1214/10-AOAS333">10.1214/10-AOAS333</a>.</p>
</div>
<div id="ref-WGS1991">
<p>Wakefield, J. C., A. E. Gelfand, and A. F. M. Smith. 1991. “Efficient Generation of Random Variates via the Ratio-of-Uniforms Method.” <em>Statistics and Computing</em> 1 (2): 129–33. doi:<a href="https://doi.org/10.1007/BF01889987">10.1007/BF01889987</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#generalised-pareto-gp-model">Generalised Pareto (GP) model</a></li>
      <li><a href="#the-generalised-extreme-value-gev-model">The Generalised Extreme Value (GEV) model</a></li>
      <li><a href="#point-process-pp-model">Point Process (PP) model</a></li>
      <li><a href="#r-largest-order-statistics-os-model"><span class="math inline">\(r\)</span>-largest Order Statistics (OS) model</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul J. Northrop.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
